# 《瀛州纪》控制指南

## ✅ 已修复的问题

### 1. 画面黑屏问题
- ✅ 增强了所有光源亮度
- ✅ 调整了背景色使其可见
- ✅ 优化了相机位置

### 2. 控制不起作用问题
- ✅ 禁用了相机的默认键盘输入
- ✅ 改用window事件监听，更可靠
- ✅ 添加了键盘事件的preventDefault
- ✅ 修复了物理引擎兼容性

### 3. 交互系统问题
- ✅ 统一了按键监听系统
- ✅ 添加了详细的调试日志
- ✅ 优化了实体检测范围

## 🎮 完整控制说明

### 移动控制
- **W** - 向前移动
- **S** - 向后移动
- **A** - 向左移动
- **D** - 向右移动
- **空格** - 跳跃

### 视角控制
- **鼠标移动** - 旋转视角
- 左右移动鼠标 - 水平转向
- 上下移动鼠标 - 垂直观看

### 交互控制
- **E** - 与附近的数字生命体交互
  - 需要在5个单位距离内
  - 成功交互会打开对话框
  - 可以选择不同的对话选项

### 调试工具
- **F1** - 切换调试面板
  - 显示实时位置
  - 显示移动速度
  - 显示当前按键
  - 显示FPS

## 🔧 故障排除

### 问题1: 按下WASD没有反应

**检查步骤：**
1. 按 `F1` 打开调试面板
2. 按下 W/A/S/D 键
3. 查看"按键"一栏是否显示相应的键

**如果调试面板显示了按键：**
- 问题可能在物理引擎
- 查看"速度"是否有变化
- 查看控制台是否有"正在移动"的日志

**如果调试面板没有显示按键：**
- 确保点击了游戏画面（Canvas获得焦点）
- 查看浏览器控制台是否有错误
- 尝试刷新页面重新进入游戏

### 问题2: 按E键无法交互

**原因：**
- 可能距离实体太远（需要 < 5 单位距离）
- 可能没有实体在附近

**解决方法：**
1. 使用WASD移动靠近彩色几何体
2. 当距离足够近时，按E键
3. 查看控制台日志：
   - ✅ "找到附近实体" - 交互成功
   - ❌ "附近没有可交互的实体" - 距离太远

### 问题3: 相机不受控制地移动

**原因：**
- 物理体可能受到异常力的作用

**解决方法：**
1. 按 `F1` 查看速度
2. 如果速度异常大，刷新页面
3. 查看控制台是否有物理引擎错误

### 问题4: 画面卡顿

**优化方法：**
1. 按 `F1` 查看FPS
2. 如果FPS < 30，在 `Game.js` 中减少：
   - 装饰立方体数量（第161行的循环）
   - 粒子系统数量（第202行的循环）

## 📊 调试面板说明

按 `F1` 打开调试面板后，你会看到：

```
调试信息
位置: (x, y, z)      - 玩家当前位置坐标
速度: (vx, vy, vz)   - 玩家当前移动速度
按键: w, d           - 当前按下的键
FPS: 60              - 每秒帧数
```

### 正常值参考
- **位置 Y值**: 1.5 ~ 3.0（在地面上）
- **速度**: 移动时应该在 -10 到 10 之间
- **FPS**: 建议 > 30，理想 60

## 🎯 控制台日志说明

### 正常启动日志
```
main.js 已加载
开始按钮被点击
初始化游戏...
场景已创建
物理引擎已启用
相机已创建
环境光已创建
...
✅ 控制系统已设置
✅ 交互系统已设置
游戏初始化完成！
```

### 按键日志
```
按键按下: w          - 检测到W键
正在移动: {...}      - 正在移动（每秒打印一次）
```

### 交互日志
```
尝试交互...
✅ 找到附近实体: 数据聚合体 0x1234...
```

或

```
尝试交互...
❌ 附近没有可交互的实体（距离 < 5）
   玩家位置: {...}
   实体数量: 8
```

## 💡 使用技巧

### 技巧1: 快速移动
- 同时按住 W 和 D 可以斜向移动
- 速度是标准化的，斜向和直走一样快

### 技巧2: 找到实体
- 彩色几何体就是数字生命实体
- 它们会悬浮并旋转
- 有名称标签显示类型和地址

### 技巧3: 有效交互
1. 找到一个彩色几何体
2. 移动到它附近（越近越好）
3. 按 E 键
4. 在对话框中选择问题
5. 了解瀛州的历史

### 技巧4: 观察世界毁灭
- 注意右上角的红色倒计时
- 世界毁灭分为6个阶段
- 每个阶段会有不同的视觉效果：
  - 初期征兆 (240秒) - 轻微闪烁
  - 结构不稳 (180秒) - 物体抖动
  - 系统崩溃 (120秒) - 场景变红
  - 最终倒计时 (60秒) - 剧烈抖动
  - 临界边缘 (30秒) - 世界解体
  - 完全湮灭 (0秒) - 渐变到白色

## 🌟 游戏目标

1. **探索瀛州** - 与至少3个数字生命体交互
2. **寻找真相** - 了解瀛州毁灭的原因
3. **见证终结** - 收集5个记忆碎片，见证世界毁灭

完成所有目标后，你会看到完整的结局。

## 🆘 仍然有问题？

如果以上方法都无法解决你的问题：

1. **刷新页面** 重新开始
2. **清除缓存** Ctrl+F5
3. **更换浏览器** 推荐 Chrome/Edge 最新版
4. **查看完整日志** 
   - 打开控制台 (F12)
   - 复制所有输出
   - 查找红色错误信息

**常见错误关键词：**
- `Cannot read property` - 对象未初始化
- `is not defined` - 模块未加载
- `Failed to fetch` - 网络问题
- `WebGL` - 显卡/驱动问题

祝你在瀛州的探索之旅愉快！ 🎮✨

