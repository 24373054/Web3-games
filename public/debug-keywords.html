<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>å…³é”®è¯è°ƒè¯•å·¥å…·</title>
  <style>
    body {
      font-family: monospace;
      background: #000;
      color: #0ff;
      padding: 20px;
    }
    .section {
      margin: 20px 0;
      padding: 15px;
      border: 1px solid #0ff;
      border-radius: 5px;
    }
    h2 { color: #ff0; }
    .keyword { 
      display: inline-block;
      padding: 5px 10px;
      margin: 5px;
      background: #333;
      border: 1px solid #0ff;
      border-radius: 3px;
    }
    .found { background: #060; border-color: #0f0; }
    button {
      background: #0ff;
      color: #000;
      border: none;
      padding: 10px 20px;
      margin: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover { background: #0cc; }
  </style>
</head>
<body>
  <h1>ğŸ” ç€›å·çºª - å…³é”®è¯è°ƒè¯•å·¥å…·</h1>
  
  <div class="section">
    <h2>ğŸ“Š å½“å‰çŠ¶æ€</h2>
    <div id="status"></div>
  </div>
  
  <div class="section">
    <h2>ğŸ”‘ NPCå…³é”®è¯é…ç½®</h2>
    <div id="npc-keywords"></div>
  </div>
  
  <div class="section">
    <h2>âœ… å·²å‘ç°çš„å…³é”®è¯</h2>
    <div id="found-keywords"></div>
  </div>
  
  <div class="section">
    <h2>ğŸ’ å·²è·å¾—çš„ç¢ç‰‡</h2>
    <div id="fragments"></div>
  </div>
  
  <div class="section">
    <button onclick="refresh()">ğŸ”„ åˆ·æ–°</button>
    <button onclick="clearData()">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰æ•°æ®</button>
  </div>

  <script>
    const NPC_KEYWORDS = {
      historian: { 
        keywords: ['åˆ›ä¸–', 'èµ·æº', 'è¯ç”Ÿ', 'å¼€ç«¯'], 
        fragmentId: 10, 
        name: 'å²å®˜Â·è®°å½•è€…'
      },
      craftsman: { 
        keywords: ['ç”Ÿå‘½', 'æˆé•¿', 'èŒèŠ½', 'è¿›åŒ–'], 
        fragmentId: 11, 
        name: 'å·¥åŒ Â·å¡‘é€ è€…'
      },
      merchant: { 
        keywords: ['ç¹è£', 'æ–‡æ˜', 'è¾‰ç…Œ', 'äº¤æ˜“'], 
        fragmentId: 12, 
        name: 'å•†åºÂ·äº¤æ˜“è€…'
      },
      prophet: { 
        keywords: ['è¡°è´¥', 'ç†µåŒ–', 'æ··ä¹±', 'é¢„è¨€'], 
        fragmentId: 13, 
        name: 'å…ˆçŸ¥Â·é¢„è¨€è€…'
      },
      forgotten: { 
        keywords: ['æ¯ç­', 'ç»ˆç»“', 'é‡ç”Ÿ', 'è½®å›'], 
        fragmentId: 14, 
        name: 'é—å¿˜è€…Â·è§è¯è€…'
      }
    };

    const FRAGMENT_NAMES = {
      10: 'èµ·æºå¯†é’¥',
      11: 'ç”Ÿå‘½å¯†ç ',
      12: 'æ–‡æ˜é—äº§',
      13: 'æ··æ²Œä¹‹å¿ƒ',
      14: 'è½®å›ä¹‹é’¥'
    };

    function refresh() {
      // æ£€æŸ¥æ‰€æœ‰å¯èƒ½çš„ localStorage keys
      const allKeys = Object.keys(localStorage);
      console.log('æ‰€æœ‰ localStorage keys:', allKeys);
      
      let data = JSON.parse(localStorage.getItem('yingzhou_mock_wallet') || '{}');
      
      // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œå°è¯•æŸ¥æ‰¾å…¶ä»–å¯èƒ½çš„ key
      if (!data.address) {
        const possibleKeys = allKeys.filter(k => k.includes('yingzhou') || k.includes('wallet') || k.includes('mock'));
        console.log('å¯èƒ½çš„ keys:', possibleKeys);
        
        if (possibleKeys.length > 0) {
          try {
            data = JSON.parse(localStorage.getItem(possibleKeys[0]) || '{}');
          } catch (e) {
            console.error('è§£æå¤±è´¥:', e);
          }
        }
      }
      
      // çŠ¶æ€
      document.getElementById('status').innerHTML = `
        <p>åœ°å€: ${data.address || 'æœªåˆ›å»º'}</p>
        <p>å½“å‰çºªå…ƒ: ${data.currentEpoch || 0}</p>
        <p>ç¢ç‰‡æ€»æ•°: ${(data.fragments || []).length}</p>
        <p>å…³é”®è¯æ€»æ•°: ${(data.keywordsFound || []).length}</p>
        <p style="color: #666; font-size: 12px;">localStorage keys: ${allKeys.length} ä¸ª</p>
        <p style="color: #666; font-size: 12px;">ä½¿ç”¨çš„ key: yingzhou_mock_wallet</p>
      `;
      
      // NPCå…³é”®è¯
      let npcHtml = '';
      for (const [npcId, config] of Object.entries(NPC_KEYWORDS)) {
        const foundKeywords = data.keywordsFound || [];
        npcHtml += `<div style="margin: 10px 0; padding: 10px; background: #111;">`;
        npcHtml += `<strong>${config.name}</strong> (ç¢ç‰‡ #${config.fragmentId})<br>`;
        npcHtml += `å…³é”®è¯: `;
        config.keywords.forEach(kw => {
          const found = foundKeywords.includes(kw);
          npcHtml += `<span class="keyword ${found ? 'found' : ''}">${kw} ${found ? 'âœ“' : ''}</span>`;
        });
        npcHtml += `</div>`;
      }
      document.getElementById('npc-keywords').innerHTML = npcHtml;
      
      // å·²å‘ç°å…³é”®è¯
      const foundKeywords = data.keywordsFound || [];
      if (foundKeywords.length > 0) {
        document.getElementById('found-keywords').innerHTML = 
          foundKeywords.map(kw => `<span class="keyword found">${kw}</span>`).join('');
      } else {
        document.getElementById('found-keywords').innerHTML = '<p style="color: #666;">æš‚æ— </p>';
      }
      
      // å·²è·å¾—ç¢ç‰‡
      const fragments = data.fragments || [];
      const hiddenFragments = fragments.filter(f => f >= 10 && f <= 14);
      if (hiddenFragments.length > 0) {
        document.getElementById('fragments').innerHTML = 
          hiddenFragments.map(f => 
            `<span class="keyword found">#${f} ${FRAGMENT_NAMES[f]}</span>`
          ).join('');
      } else {
        document.getElementById('fragments').innerHTML = '<p style="color: #666;">æš‚æ— éšè—ç¢ç‰‡</p>';
      }
    }

    function clearData() {
      if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ•°æ®å—ï¼Ÿè¿™å°†é‡ç½®ä½ çš„æ¸¸æˆè¿›åº¦ï¼')) {
        localStorage.removeItem('yingzhou_mock_wallet');
        alert('æ•°æ®å·²æ¸…é™¤ï¼');
        refresh();
      }
    }

    // åˆå§‹åŠ è½½
    refresh();
  </script>
</body>
</html>
