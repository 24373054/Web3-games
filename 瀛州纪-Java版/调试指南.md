# 瀛州纪 Java版 - 调试指南

## 🔍 如何查看错误日志

### 方法1: 查看日志文件（推荐）

游戏运行时会自动创建日志文件 `yingzhou-game.log`，位于游戏JAR文件的同一目录。

**Windows:**
```cmd
# 运行游戏
java -jar yingzhou-java-1.0.jar

# 在另一个命令行窗口实时查看日志
type yingzhou-game.log
# 或使用记事本打开
notepad yingzhou-game.log
```

**Linux/Mac:**
```bash
# 运行游戏
java -jar yingzhou-java-1.0.jar

# 在另一个终端实时查看日志
tail -f yingzhou-game.log
```

### 方法2: 查看控制台输出

**Windows:**
```cmd
# 在命令行中运行，不要双击JAR文件
java -jar yingzhou-java-1.0.jar

# 所有日志会同时输出到控制台
```

**Linux/Mac:**
```bash
# 在终端中运行
java -jar yingzhou-java-1.0.jar

# 或者将输出保存到文件
java -jar yingzhou-java-1.0.jar 2>&1 | tee console.log
```

### 方法3: 重定向输出到文件

**Windows:**
```cmd
java -jar yingzhou-java-1.0.jar > output.log 2>&1
```

**Linux/Mac:**
```bash
java -jar yingzhou-java-1.0.jar > output.log 2>&1
```

## 📋 日志级别说明

日志文件包含以下级别的信息：

- **INFO**: 正常运行信息（启动、关闭、重要操作）
- **DEBUG**: 调试信息（按键、移动、详细状态）
- **WARN**: 警告信息（非致命问题）
- **ERROR**: 错误信息（包含完整堆栈跟踪）

### 日志示例

```
[2025-12-23 16:47:00] [INFO] === 瀛州纪游戏启动 ===
[2025-12-23 16:47:00] [INFO] === 瀛州纪 Java版 v1.0 ===
[2025-12-23 16:47:00] [INFO] 系统信息:
[2025-12-23 16:47:00] [INFO]   Java版本: 17.0.9
[2025-12-23 16:47:00] [INFO]   JavaFX版本: 21
[2025-12-23 16:47:00] [INFO]   操作系统: Windows 10
[2025-12-23 16:47:01] [INFO] 开始启动游戏...
[2025-12-23 16:47:01] [INFO] 游戏引擎初始化完成
[2025-12-23 16:47:01] [INFO] 初始化3D场景管理器...
[2025-12-23 16:47:01] [DEBUG] 3D根节点创建成功
[2025-12-23 16:47:01] [DEBUG] 相机创建成功
[2025-12-23 16:47:01] [INFO] 玩家初始化完成，位置: Point3D [x = 0.0, y = 2.0, z = 10.0]
[2025-12-23 16:47:02] [DEBUG] 按键按下: W
[2025-12-23 16:47:02] [DEBUG] 玩家开始向前移动
```

## 🐛 常见问题排查

### 问题1: 游戏无法启动

**症状**: 双击JAR文件没有反应

**解决方法**:
1. 在命令行中运行查看错误信息
2. 检查日志文件 `yingzhou-game.log`
3. 确认JDK版本是否正确（需要包含JavaFX）

```bash
# 检查Java版本
java -version

# 检查是否包含JavaFX
java --list-modules | grep javafx
```

### 问题2: 提示缺少JavaFX

**症状**: 
```
Error: JavaFX runtime components are missing
```

**解决方法**:
安装包含JavaFX的JDK：
- Liberica Full JDK 17+
- Azul Zulu JDK FX 17+

详见 `Windows运行指南.md`

### 问题3: 3D场景不显示

**症状**: 游戏启动但看不到3D场景

**排查步骤**:
1. 查看日志文件中的错误信息
2. 检查显卡驱动是否支持OpenGL 2.0+
3. 尝试更新显卡驱动

**日志关键词**:
```
[ERROR] 3D场景管理器初始化失败
[ERROR] 初始化3D场景时出错
```

### 问题4: 键盘操作无响应

**症状**: 按WASD键无法移动

**排查步骤**:
1. 确认游戏窗口获得了焦点（点击窗口）
2. 查看日志是否有按键事件记录
3. 检查是否有其他程序占用了键盘

**日志关键词**:
```
[DEBUG] 按键按下: W
[DEBUG] 玩家开始向前移动
```

如果看不到这些日志，说明按键事件没有被捕获。

### 问题5: 鼠标视角控制不正常

**症状**: 移动鼠标视角不动或跳动

**排查步骤**:
1. 尝试拖拽鼠标而不是移动
2. 检查鼠标灵敏度设置
3. 查看日志中的鼠标事件

**日志关键词**:
```
[DEBUG] 处理鼠标移动事件出错
```

### 问题6: 游戏卡顿或FPS低

**症状**: 游戏运行不流畅

**解决方法**:
1. 降低窗口大小（不要最大化）
2. 关闭其他占用GPU的程序
3. 更新显卡驱动
4. 检查CPU和内存占用

**性能监控**:
```bash
# Windows - 任务管理器
Ctrl + Shift + Esc

# Linux
top
htop

# Mac
Activity Monitor
```

## 🔧 调试模式

### 启用详细日志

修改 `Logger.java` 中的日志级别，或在运行时添加参数：

```bash
# 启用调试日志
java -Dyingzhou.log.level=DEBUG -jar yingzhou-java-1.0.jar

# 启用所有日志
java -Dyingzhou.log.level=ALL -jar yingzhou-java-1.0.jar
```

### 性能分析

```bash
# 启用JVM性能监控
java -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -jar yingzhou-java-1.0.jar

# 启用内存分析
java -Xms512m -Xmx2g -XX:+HeapDumpOnOutOfMemoryError -jar yingzhou-java-1.0.jar
```

## 📊 系统要求检查

### 检查清单

```bash
# 1. Java版本
java -version
# 应该显示: java version "17.x.x" 或更高

# 2. JavaFX模块
java --list-modules | grep javafx
# 应该显示: javafx.base, javafx.controls, javafx.graphics 等

# 3. 显卡信息 (Windows)
dxdiag

# 4. 显卡信息 (Linux)
lspci | grep VGA
glxinfo | grep OpenGL

# 5. 内存
# Windows: systeminfo | findstr Memory
# Linux: free -h
# Mac: sysctl hw.memsize
```

## 📝 报告问题

如果遇到无法解决的问题，请提供以下信息：

1. **系统信息**:
   - 操作系统版本
   - Java版本
   - JavaFX版本
   - 显卡型号

2. **日志文件**:
   - 完整的 `yingzhou-game.log` 文件
   - 或控制台输出的截图

3. **问题描述**:
   - 具体症状
   - 复现步骤
   - 预期行为

4. **截图/录屏**:
   - 问题发生时的截图
   - 如果可能，提供录屏

### 提交方式

```bash
# 1. 收集日志
cp yingzhou-game.log bug-report-$(date +%Y%m%d).log

# 2. 收集系统信息
java -version > system-info.txt 2>&1
java --list-modules | grep javafx >> system-info.txt

# 3. 打包提交
# 将 bug-report-*.log 和 system-info.txt 一起提交
```

## 🎯 快速测试

### 测试脚本

**Windows (test.bat):**
```batch
@echo off
echo 测试瀛州纪 Java版
echo.

echo 1. 检查Java版本
java -version
echo.

echo 2. 检查JavaFX模块
java --list-modules | findstr javafx
echo.

echo 3. 运行游戏（5秒后自动关闭）
timeout /t 5
java -jar yingzhou-java-1.0.jar
echo.

echo 4. 检查日志文件
if exist yingzhou-game.log (
    echo 日志文件已创建
    type yingzhou-game.log
) else (
    echo 警告: 日志文件未创建
)

pause
```

**Linux/Mac (test.sh):**
```bash
#!/bin/bash
echo "测试瀛州纪 Java版"
echo

echo "1. 检查Java版本"
java -version
echo

echo "2. 检查JavaFX模块"
java --list-modules | grep javafx
echo

echo "3. 运行游戏（5秒后自动关闭）"
timeout 5 java -jar yingzhou-java-1.0.jar &
PID=$!
sleep 5
kill $PID 2>/dev/null
echo

echo "4. 检查日志文件"
if [ -f yingzhou-game.log ]; then
    echo "日志文件已创建"
    cat yingzhou-game.log
else
    echo "警告: 日志文件未创建"
fi
```

## 💡 优化建议

### 性能优化

1. **降低分辨率**: 不要使用最大化窗口
2. **关闭抗锯齿**: 修改 `Scene3DManager.java` 中的 `SceneAntialiasing.BALANCED` 为 `SceneAntialiasing.DISABLED`
3. **减少NPC数量**: 临时注释掉部分NPC
4. **增加内存**: `java -Xmx2g -jar yingzhou-java-1.0.jar`

### 稳定性优化

1. **使用稳定版JDK**: 推荐 Liberica Full JDK 17 LTS
2. **更新显卡驱动**: 确保支持最新的OpenGL
3. **关闭后台程序**: 释放系统资源

## 📞 获取帮助

- **查看文档**: README.md, 最新优化说明.md
- **查看日志**: yingzhou-game.log
- **提交Issue**: 附上日志和系统信息

---

**记住**: 日志文件 `yingzhou-game.log` 是排查问题的关键！
