# 瀛州纪 Java版 - 开发指南

## 项目架构

### 核心模块

1. **launcher** - 启动器模块
   - `VersionSelector.java`: 版本选择界面

2. **game** - 游戏核心模块
   - `GameEngine.java`: 游戏引擎
   - `GameLauncher.java`: 游戏启动器
   - `epoch/EpochManager.java`: 纪元管理
   - `player/Player.java`: 玩家控制

3. **npc** - NPC系统
   - `BaseNPC.java`: NPC基类
   - `ArchivistNPC.java`: 史官
   - `ArchitectNPC.java`: 工匠
   - `MercantileNPC.java`: 商序
   - `OracleNPC.java`: 先知
   - `EntropyNPC.java`: 遗忘者
   - `NPCManager.java`: NPC管理器

4. **scene3d** - 3D场景
   - `Scene3DManager.java`: 3D场景管理器

5. **ui** - 用户界面
   - `GameUI.java`: 游戏UI管理器

6. **data** - 数据管理
   - `GameData.java`: 游戏数据保存/加载

## 开发流程

### 添加新NPC

1. 创建新的NPC类继承`BaseNPC`
2. 实现`interact()`, `getDialogue()`, `startMiniGame()`方法
3. 在`NPCManager.initializeNPCs()`中注册

### 添加新纪元

1. 在`EpochManager.Epoch`枚举中添加新纪元
2. 定义纪元的背景色和特性
3. 更新`canAdvanceToNextEpoch()`和`advanceEpoch()`逻辑

### 添加小游戏

1. 在`minigame`包中创建新的小游戏类
2. 实现游戏逻辑和UI
3. 在对应NPC的`startMiniGame()`中调用

## 编译和运行

### 开发模式

```bash
# Windows
run.bat

# Linux/Mac
chmod +x run.sh
./run.sh
```

### 手动编译

```bash
# 编译
mvn clean compile

# 运行
mvn javafx:run

# 打包
mvn package

# 运行打包后的JAR
java -jar target/yingzhou-java-1.0.jar
```

## 调试技巧

### 启用详细日志

在`src/main/resources/logback.xml`中配置日志级别：

```xml
<logger name="com.yingzhou" level="DEBUG"/>
```

### 性能监控

在`GameEngine`中添加性能计数器：

```java
private long frameCount = 0;
private long lastFpsTime = System.currentTimeMillis();

private void update(double deltaTime) {
    frameCount++;
    long currentTime = System.currentTimeMillis();
    if (currentTime - lastFpsTime >= 1000) {
        System.out.println("FPS: " + frameCount);
        frameCount = 0;
        lastFpsTime = currentTime;
    }
    // ...
}
```

## 常见问题

### Q: JavaFX找不到模块

A: 确保在`pom.xml`中正确配置了JavaFX依赖，并使用`javafx-maven-plugin`运行

### Q: 3D场景不显示

A: 检查相机设置和光源配置，确保几何体在相机视野内

### Q: 鼠标控制不灵敏

A: 调整`Player.MOUSE_SENSITIVITY`常量

## 扩展功能建议

1. **多人模式**: 使用Socket实现网络同步
2. **AI对话**: 集成ChatGPT API实现动态对话
3. **音效系统**: 使用JavaFX Media API添加背景音乐和音效
4. **粒子系统**: 实现粒子效果增强视觉体验
5. **存档系统**: 完善GameData实现多存档支持

## 贡献指南

欢迎提交PR！请遵循以下规范：

1. 代码风格遵循Java标准
2. 添加必要的注释
3. 更新相关文档
4. 测试新功能

## 许可证

MIT License
