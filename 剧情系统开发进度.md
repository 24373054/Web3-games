# ç€›å·çºª - å‰§æƒ…ç³»ç»Ÿå¼€å‘è¿›åº¦

æœ€åæ›´æ–°ï¼š2025-11-08

---

## âœ… å·²å®Œæˆï¼ˆé˜¶æ®µä¸€ - æ ¸å¿ƒæ¶æ„ï¼‰

### 1. æ™ºèƒ½åˆçº¦å±‚

#### 1.1 EpochManager åˆçº¦ âœ…
**æ–‡ä»¶**: `contracts/EpochManager.sol`

**åŠŸèƒ½**:
- âœ… äº”å¤§çºªå…ƒé…ç½®ï¼ˆåˆ›ä¸–ã€èŒèŠ½ã€ç¹ç››ã€ç†µåŒ–ã€æ¯ç­ï¼‰
- âœ… çºªå…ƒçŠ¶æ€ç®¡ç†ï¼ˆåç§°ã€åŒºå—èŒƒå›´ã€å’Œè°åº¦ã€é¢œè‰²ä¸»é¢˜ï¼‰
- âœ… çºªå…ƒæ¨è¿›æ¡ä»¶ï¼ˆç¢ç‰‡æ•°ã€NPCå¯¹è¯è¦æ±‚ï¼‰
- âœ… ç©å®¶çºªå…ƒè¿›åº¦è¿½è¸ª
- âœ… çºªå…ƒå†å²è®°å½•

**å…³é”®æ–¹æ³•**:
```solidity
getCurrentEpoch(address player) // è·å–ç©å®¶å½“å‰çºªå…ƒ
getEpochState(uint8 epochId)   // è·å–çºªå…ƒè¯¦æƒ…
canAdvanceEpoch(address player) // æ£€æŸ¥æ˜¯å¦å¯æ¨è¿›
advanceEpoch(address player)    // æ¨è¿›åˆ°ä¸‹ä¸€çºªå…ƒ
getEpochTheme(uint8 epochId)    // è·å–è§†è§‰ä¸»é¢˜
```

#### 1.2 MemoryFragment åˆçº¦ âœ…
**æ–‡ä»¶**: `contracts/MemoryFragment.sol`

**åŠŸèƒ½**:
- âœ… ERC721 NFT å®ç°
- âœ… 18ä¸ªç¢ç‰‡å®Œæ•´é…ç½®ï¼ˆ8ä¸»è¦ + 10éšè—ï¼‰
- âœ… æ¯ä¸ªç¢ç‰‡åŒ…å«ï¼šæ ‡é¢˜ã€å†…å®¹ã€åŒºå—å·ã€çºªå…ƒã€è§¦å‘å…³é”®è¯
- âœ… ç©å®¶ç¢ç‰‡æ”¶é›†è¿½è¸ª
- âœ… è¿›åº¦ç»Ÿè®¡ï¼ˆä¸»è¦/éšè—ç¢ç‰‡åˆ†ç±»ï¼‰
- âœ… æˆæƒé“¸é€ æœºåˆ¶

**18ä¸ªç¢ç‰‡å†…å®¹**:

| ID | åç§° | ç±»å‹ | çºªå…ƒ | è§¦å‘å…³é”®è¯ |
|----|------|------|------|-----------|
| 1 | åˆ›ä¸–ä¹‹å…‰ | ä¸»è¦ | åˆ›ä¸– | - |
| 2 | æ¡æ‰‹åè®® | ä¸»è¦ | èŒèŠ½ | - |
| 3 | ä¿¡ä»»çš„ä»£ç  | ä¸»è¦ | èŒèŠ½ | - |
| 4 | ä»£ç è¯—æ­Œ | ä¸»è¦ | ç¹ç›› | - |
| 5 | å®Œç¾çš„ä»£ä»· | ä¸»è¦ | ç¹ç›› | - |
| 6 | é¢„è¨€çš„æ‚–è®º | ä¸»è¦ | ç†µåŒ– | - |
| 7 | ç†µçš„å¿…ç„¶æ€§ | ä¸»è¦ | ç†µåŒ– | - |
| 8 | æœ€åçš„å‡½æ•° | ä¸»è¦ | æ¯ç­ | - |
| 9 | å­˜åœ¨çš„è¯æ˜ | éšè— | åˆ›ä¸– | "å­˜åœ¨çš„è¯æ˜" |
| 10 | åˆ›é€ è€…ä¹‹è°œ | éšè— | åˆ›ä¸– | "åˆ›é€ è€…" |
| 11 | require()çš„æœ¬è´¨ | éšè— | èŒèŠ½ | "ä¿¡ä»»" |
| 12 | ç¬¬ä¸€ä¸ªDAO | éšè— | èŒèŠ½ | "DAO" |
| 13 | è‰ºæœ¯çš„å®šä¹‰ | éšè— | ç¹ç›› | "è‰ºæœ¯" |
| 14 | Gasçš„å“²å­¦ | éšè— | ç¹ç›› | "Gas" |
| 15 | è®°å¿†çš„æº¶è§£ | éšè— | ç†µåŒ– | "é—å¿˜" |
| 16 | å®¿å‘½ä¸è‡ªç”± | éšè— | ç†µåŒ– | "å®¿å‘½" |
| 17 | æ··æ²Œçš„çœŸç›¸ | éšè— | ç†µåŒ– | "æ··æ²Œ" |
| 18 | æ°¸æ’çš„è´¦æœ¬ | éšè— | æ¯ç­ | "æ°¸æ’" |

**å…³é”®æ–¹æ³•**:
```solidity
mintFragment(address player, uint8 fragmentId) // é“¸é€ ç¢ç‰‡
getPlayerFragments(address player)             // è·å–ç©å®¶ç¢ç‰‡
getPlayerProgress(address player)              // è·å–æ”¶é›†è¿›åº¦
getFragment(uint8 fragmentId)                  // è·å–ç¢ç‰‡è¯¦æƒ…
hasFragment(address player, uint8 fragmentId)  // æ£€æŸ¥æ‹¥æœ‰
```

### 2. éƒ¨ç½²è„šæœ¬å±‚ âœ…

**æ–‡ä»¶**: `scripts/deploy-and-setup.js`

**æ–°å¢åŠŸèƒ½**:
- âœ… éƒ¨ç½² EpochManager åˆçº¦
- âœ… éƒ¨ç½² MemoryFragment åˆçº¦
- âœ… é…ç½®æˆæƒå…³ç³»ï¼š
  - EpochManager å¯é“¸é€ ç¢ç‰‡
  - AINPC å¯é“¸é€ ç¢ç‰‡ï¼ˆç”¨äºå…³é”®è¯è§¦å‘ï¼‰
- âœ… è‡ªåŠ¨æ›´æ–° .env.localï¼š
  - `NEXT_PUBLIC_EPOCH_MANAGER_ADDRESS`
  - `NEXT_PUBLIC_MEMORY_FRAGMENT_ADDRESS`

### 3. å‰ç«¯åŸºç¡€è®¾æ–½ âœ…

**æ–‡ä»¶**: `lib/contracts.ts`

**æ–°å¢åŠŸèƒ½**:
- âœ… å¯¼å…¥æ–°åˆçº¦ABI
- âœ… åœ°å€é…ç½®ï¼ˆepochManager, memoryFragmentï¼‰
- âœ… åˆçº¦è®¿é—®å‡½æ•°ï¼š
  - `getEpochManagerContract()`
  - `getMemoryFragmentContract()`

---

## ğŸ“‹ ä¸‹ä¸€æ­¥è®¡åˆ’ï¼ˆé˜¶æ®µäºŒï¼‰

### 4. å‰ç«¯UIç»„ä»¶

#### 4.1 è®°å¿†ç¢ç‰‡æ”¶è—ç•Œé¢ ğŸ”²
**æ–‡ä»¶**: `components/FragmentGallery.tsx`

**åŠŸèƒ½éœ€æ±‚**:
- [ ] 18æ ¼ç½‘æ ¼å±•ç¤ºæ‰€æœ‰ç¢ç‰‡
- [ ] æœªè·å¾—ç¢ç‰‡æ˜¾ç¤ºæš—å½±è½®å»“
- [ ] å·²è·å¾—ç¢ç‰‡é«˜äº®æ˜¾ç¤º
- [ ] ç‚¹å‡»æŸ¥çœ‹ç¢ç‰‡è¯¦æƒ…ï¼ˆæ ‡é¢˜ã€å†…å®¹ã€åŒºå—å·ï¼‰
- [ ] è¿›åº¦æ¡ï¼šä¸»è¦ç¢ç‰‡ X/8ï¼Œéšè—ç¢ç‰‡ Y/10
- [ ] æŒ‰çºªå…ƒç­›é€‰æ˜¾ç¤º

#### 4.2 çºªå…ƒåˆ‡æ¢UI ğŸ”²
**æ–‡ä»¶**: `components/EpochPanel.tsx`

**åŠŸèƒ½éœ€æ±‚**:
- [ ] æ˜¾ç¤ºå½“å‰çºªå…ƒåç§°å’Œæè¿°
- [ ] æ˜¾ç¤ºæ¨è¿›æ¡ä»¶ï¼ˆæ‰€éœ€ç¢ç‰‡ã€NPCå¯¹è¯ï¼‰
- [ ] çºªå…ƒæ¨è¿›æŒ‰é’®ï¼ˆæ¡ä»¶æ»¡è¶³æ—¶å¯ç”¨ï¼‰
- [ ] äº”å¤§çºªå…ƒæ—¶é—´çº¿å¯è§†åŒ–
- [ ] çºªå…ƒåˆ‡æ¢åŠ¨ç”»æ•ˆæœ

#### 4.3 çºªå…ƒè§†è§‰ç³»ç»Ÿ ğŸ”²
**æ–‡ä»¶**: `components/Scene3D/EpochVisuals.tsx`

**åŠŸèƒ½éœ€æ±‚**:
- [ ] 5ç§çºªå…ƒé…è‰²æ–¹æ¡ˆ
- [ ] åœºæ™¯é¢œè‰²åŠ¨æ€åˆ‡æ¢
- [ ] æ³¡æ³¡é¢œè‰²éšçºªå…ƒå˜åŒ–
- [ ] ç²’å­æ•ˆæœéšçºªå…ƒè°ƒæ•´
- [ ] è½¬åœºåŠ¨ç”»ï¼ˆæ·¡å…¥æ·¡å‡ºï¼‰

### 5. AIå¯¹è¯ç³»ç»Ÿå‡çº§ ğŸ”²

**æ–‡ä»¶**: `app/api/ai-chat/route.ts`

**åŠŸèƒ½éœ€æ±‚**:
- [ ] çºªå…ƒæ„ŸçŸ¥ï¼šæ ¹æ®ç©å®¶å½“å‰çºªå…ƒè°ƒæ•´å¯¹è¯
- [ ] å…³é”®è¯æ£€æµ‹ï¼šè¯†åˆ«ç”¨æˆ·æ¶ˆæ¯ä¸­çš„è§¦å‘è¯
- [ ] éšè—ç¢ç‰‡å¥–åŠ±ï¼šå…³é”®è¯åŒ¹é…æ—¶é“¸é€ ç¢ç‰‡
- [ ] NPCä¸ªæ€§åŒ–ï¼š5ä¸ªNPCåœ¨ä¸åŒçºªå…ƒçš„ä¸åŒè¡¨ç°

### 6. å°æ¸¸æˆç³»ç»Ÿ ğŸ”²

**åˆçº¦**: `contracts/MiniGameManager.sol`

**åŠŸèƒ½éœ€æ±‚**:
- [ ] 6ç§å°æ¸¸æˆé€»è¾‘
- [ ] å®Œæˆåº¦è®¡ç®—ï¼ˆæ—¶é—´+å‡†ç¡®åº¦+æµç•…åº¦ï¼‰
- [ ] æˆç»©è®°å½•ä¸æŸ¥è¯¢
- [ ] ç¢ç‰‡å¥–åŠ±åˆ†å‘

**å‰ç«¯ç»„ä»¶**:
- [ ] `MiniGames/MemorySort.tsx` - è®°å¿†æ’åº
- [ ] `MiniGames/HandshakeProtocol.tsx` - æ¡æ‰‹åè®®
- [ ] `MiniGames/ResourceBalance.tsx` - èµ„æºå¹³è¡¡
- [ ] `MiniGames/CodeBuilder.tsx` - ä»£ç æ„å»º
- [ ] `MiniGames/FuturePrediction.tsx` - æœªæ¥æ¨æ¼”
- [ ] `MiniGames/ChaosMaze.tsx` - æ··æ²Œè¿·å®«

---

## ğŸ§ª å¦‚ä½•æµ‹è¯•å½“å‰åŠŸèƒ½

### 1. éƒ¨ç½²æ–°åˆçº¦

```bash
cd ç€›å·çºª
npm run deploy:auto
```

è¿™ä¼šï¼š
- éƒ¨ç½²æ‰€æœ‰åˆçº¦ï¼ˆåŒ…æ‹¬æ–°çš„ EpochManager å’Œ MemoryFragmentï¼‰
- è‡ªåŠ¨æ›´æ–° .env.local
- é…ç½®æˆæƒå…³ç³»

### 2. åœ¨å‰ç«¯è¯»å–çºªå…ƒä¿¡æ¯

```typescript
import { getEpochManagerContract } from '@/lib/contracts'
import { getRpcProvider } from '@/lib/provider'

// è·å–å½“å‰çºªå…ƒ
const epochManager = getEpochManagerContract(getRpcProvider())
const epoch = await epochManager.getCurrentEpoch(playerAddress)
console.log('å½“å‰çºªå…ƒ:', epoch) // 0-4

// è·å–çºªå…ƒè¯¦æƒ…
const epochState = await epochManager.getEpochState(epoch)
console.log('çºªå…ƒåç§°:', epochState.name)
console.log('é¢œè‰²ä¸»é¢˜:', epochState.colorTheme)
```

### 3. æŸ¥è¯¢ç¢ç‰‡ä¿¡æ¯

```typescript
import { getMemoryFragmentContract } from '@/lib/contracts'

const fragmentContract = getMemoryFragmentContract(getRpcProvider())

// è·å–æ‰€æœ‰ç¢ç‰‡ï¼ˆä¾›å‰ç«¯å±•ç¤ºï¼‰
const allFragments = await fragmentContract.getAllFragments()
console.log('æ€»ç¢ç‰‡æ•°:', allFragments.length)

// è·å–ç‰¹å®šç¢ç‰‡
const fragment1 = await fragmentContract.getFragment(1)
console.log('ç¢ç‰‡1:', fragment1.title) // "åˆ›ä¸–ä¹‹å…‰"
console.log('å†…å®¹:', fragment1.content)

// æŸ¥è¯¢ç©å®¶è¿›åº¦
const progress = await fragmentContract.getPlayerProgress(playerAddress)
console.log('ä¸»è¦ç¢ç‰‡:', progress.mainCollected, '/ 8')
console.log('éšè—ç¢ç‰‡:', progress.hiddenCollected, '/ 10')
```

### 4. æµ‹è¯•ç¢ç‰‡é“¸é€ ï¼ˆéœ€è¦owneræƒé™ï¼‰

```typescript
import { getMemoryFragmentContract } from '@/lib/contracts'
import { ethers } from 'ethers'

const signer = await provider.getSigner()
const fragmentContract = getMemoryFragmentContract(signer)

// é“¸é€ ç¢ç‰‡#1ç»™ç©å®¶
const tx = await fragmentContract.mintFragment(playerAddress, 1)
await tx.wait()

console.log('ç¢ç‰‡é“¸é€ æˆåŠŸï¼')
```

---

## ğŸ“Š å¼€å‘è¿›åº¦ç»Ÿè®¡

### æ™ºèƒ½åˆçº¦ (40% å®Œæˆ)
- âœ… EpochManager
- âœ… MemoryFragment  
- â³ MiniGameManager (å¾…å¼€å‘)
- â³ AINPCæ‰©å±• (å¾…å¼€å‘)

### å‰ç«¯UI (10% å®Œæˆ)
- âœ… åˆçº¦è®¿é—®åŸºç¡€è®¾æ–½
- â³ ç¢ç‰‡æ”¶è—ç•Œé¢ (å¾…å¼€å‘)
- â³ çºªå…ƒåˆ‡æ¢UI (å¾…å¼€å‘)
- â³ å°æ¸¸æˆç»„ä»¶ (å¾…å¼€å‘)
- â³ 3Dè§†è§‰çºªå…ƒåŒ– (å¾…å¼€å‘)

### AIç³»ç»Ÿ (0% å®Œæˆ)
- â³ çºªå…ƒæ„ŸçŸ¥ (å¾…å¼€å‘)
- â³ å…³é”®è¯è§¦å‘ (å¾…å¼€å‘)
- â³ ä¸ªæ€§åŒ–å¯¹è¯ (å¾…å¼€å‘)

---

## ğŸ’¡ ä¸‹ä¸€æ­¥è¡ŒåŠ¨å»ºè®®

1. **ç«‹å³å¯åš**ï¼š
   - è¿è¡Œ `npm run deploy:auto` éƒ¨ç½²æ–°åˆçº¦
   - åˆ›å»º `FragmentGallery.tsx` ç»„ä»¶å±•ç¤º18ä¸ªç¢ç‰‡
   - æµ‹è¯•ç¢ç‰‡è¯»å–å’Œå±•ç¤º

2. **çŸ­æœŸç›®æ ‡ï¼ˆ1å‘¨å†…ï¼‰**ï¼š
   - å®Œæˆç¢ç‰‡æ”¶è—ç•Œé¢
   - å®ç°çºªå…ƒåˆ‡æ¢UI
   - åœ¨3Dåœºæ™¯ä¸­é›†æˆçºªå…ƒé¢œè‰²

3. **ä¸­æœŸç›®æ ‡ï¼ˆ2-3å‘¨ï¼‰**ï¼š
   - å¼€å‘å°æ¸¸æˆç³»ç»Ÿ
   - å‡çº§AIå¯¹è¯ï¼ˆçºªå…ƒæ„ŸçŸ¥ï¼‰
   - å®ç°å…³é”®è¯è§¦å‘æœºåˆ¶

---

**å‡†å¤‡å¥½éƒ¨ç½²æ–°åˆçº¦å¹¶å¼€å§‹æµ‹è¯•äº†å—ï¼Ÿ** ğŸš€

