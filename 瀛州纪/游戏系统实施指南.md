# ç€›å·çºª - æ¸¸æˆç³»ç»Ÿå®æ–½æŒ‡å—

> åŸºäºã€Šæ¸¸æˆå‰§æƒ….mdã€‹ï¼ˆ2391è¡Œï¼‰å®Œæ•´æ–‡æ¡£çš„æŠ€æœ¯å®æ–½æ–¹æ¡ˆ

æœ€åæ›´æ–°ï¼š2025-11-08

---

## ğŸ¯ æ€»è§ˆ

### æ ¸å¿ƒè®¾è®¡è¦ç´ 

1. **äº”å¤§çºªå…ƒç³»ç»Ÿ**
   - åˆ›ä¸–ï¼ˆGenesisï¼‰ï¼šBlock #0 - #49,999
   - èŒèŠ½ï¼ˆEmergenceï¼‰ï¼šBlock #50,000 - #99,999
   - ç¹ç››ï¼ˆFlourishï¼‰ï¼šBlock #100,000 - #149,999
   - ç†µåŒ–ï¼ˆEntropyï¼‰ï¼šBlock #150,000 - #199,999
   - æ¯ç­ï¼ˆCollapseï¼‰ï¼šBlock #200,000

2. **18ä¸ªè®°å¿†ç¢ç‰‡NFT**
   - 8ä¸ªä¸»è¦ç¢ç‰‡ï¼ˆé€šè¿‡å°æ¸¸æˆè·å¾—ï¼‰
   - 10ä¸ªéšè—ç¢ç‰‡ï¼ˆé€šè¿‡å…³é”®è¯è§¦å‘ï¼‰

3. **5ä¸ªAI-NPCè§’è‰²**
   - å²å®˜ï¼ˆArchivistï¼‰ï¼šè®°å¿†çš„å®ˆæŠ¤è€…
   - å·¥åŒ ï¼ˆArchitectï¼‰ï¼šåˆ›ä¸–çš„è®¾è®¡è€…
   - å•†åºï¼ˆMercantileï¼‰ï¼šæµåŠ¨çš„ä»²è£è€…
   - å…ˆçŸ¥ï¼ˆOracleï¼‰ï¼šæœªæ¥çš„å›å£°
   - é—å¿˜è€…ï¼ˆEntropyï¼‰ï¼šæ··æ²Œçš„åŒ–èº«

4. **6ç§å°æ¸¸æˆ**
   - è®°å¿†æ’åºï¼ˆMemory Sortingï¼‰
   - æ¡æ‰‹åè®®ï¼ˆHandshake Protocolï¼‰
   - èµ„æºå¹³è¡¡ï¼ˆResource Balanceï¼‰
   - ä»£ç æ„å»ºï¼ˆCode Builderï¼‰
   - æœªæ¥æ¨æ¼”ï¼ˆFuture Predictionï¼‰
   - æ··æ²Œè¿·å®«ï¼ˆChaos Mazeï¼‰

5. **10ä¸ªå…³é”®è¯è§¦å‘å™¨**
   - åˆ›ä¸–çºªå…ƒï¼šã€Œå­˜åœ¨çš„è¯æ˜ã€ã€Œåˆ›é€ è€…ã€
   - èŒèŠ½çºªå…ƒï¼šã€Œä¿¡ä»»ã€ã€ŒDAOã€
   - ç¹ç››çºªå…ƒï¼šã€Œè‰ºæœ¯ã€ã€ŒGasã€
   - ç†µåŒ–çºªå…ƒï¼šã€Œé—å¿˜ã€ã€Œå®¿å‘½ã€ã€Œæ··æ²Œã€
   - æ¯ç­çºªå…ƒï¼šã€Œæ°¸æ’ã€

---

## ğŸ“‹ é˜¶æ®µä¸€ï¼šæ™ºèƒ½åˆçº¦å±‚ï¼ˆå·²å®Œæˆâœ…ï¼‰

### 1.1 EpochManager.sol âœ…
**åŠŸèƒ½**ï¼šç®¡ç†5ä¸ªçºªå…ƒçš„çŠ¶æ€å’Œåˆ‡æ¢

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```solidity
// è·å–ç©å®¶å½“å‰çºªå…ƒ
function getCurrentEpoch(address player) public view returns (Epoch)

// è·å–çºªå…ƒé…ç½®
function getEpochConfig(Epoch epoch) public view returns (EpochConfig memory)

// æ¨è¿›åˆ°ä¸‹ä¸€çºªå…ƒ
function advanceEpoch(address player) public onlyDigitalBeingContract

// è®°å½•ç¢ç‰‡æ”¶é›†
function recordFragmentCollection(address player, uint256 fragmentId) public

// è·å–ç©å®¶æ”¶é›†çš„ç¢ç‰‡æ€»æ•°
function getTotalFragmentsCollected(address player) public view returns (uint256)
```

**çºªå…ƒé…ç½®**ï¼š
```solidity
struct EpochConfig {
    uint256 minFragments;           // æ¨è¿›æ‰€éœ€ç¢ç‰‡æ•°
    uint256 minNPCInteractions;     // æ¨è¿›æ‰€éœ€NPCå¯¹è¯æ•°
    string name;                    // çºªå…ƒåç§°
    string description;             // çºªå…ƒæè¿°
    string primaryColor;            // ä¸»è‰²è°ƒï¼ˆå‰ç«¯ç”¨ï¼‰
    string secondaryColor;          // æ¬¡è¦è‰²è°ƒ
    string accentColor;             // å¼ºè°ƒè‰²
}
```

**çºªå…ƒæ¨è¿›æ¡ä»¶**ï¼š
| çºªå…ƒ | æ‰€éœ€ç¢ç‰‡ | æ‰€éœ€NPCå¯¹è¯ |
|------|---------|-----------|
| Genesis â†’ Emergence | 1 | 1 |
| Emergence â†’ Flourish | 3 | 2 |
| Flourish â†’ Entropy | 5 | 3 |
| Entropy â†’ Collapse | 7 | 4 |

### 1.2 MemoryFragment.sol âœ…
**åŠŸèƒ½**ï¼šERC1155 è®°å¿†ç¢ç‰‡NFTç®¡ç†

**18ä¸ªç¢ç‰‡è¯¦æƒ…**ï¼š

#### ä¸»è¦ç¢ç‰‡ï¼ˆ8ä¸ªï¼‰
| ID | åç§° | çºªå…ƒ | è·å–æ–¹å¼ |
|----|------|------|---------|
| 0 | åˆ›ä¸–ä¹‹å…‰ | åˆ›ä¸– | ä¸å²å®˜å®Œæˆã€Œè®°å¿†æ’åºã€å°æ¸¸æˆ |
| 1 | å­˜åœ¨çš„è¯æ˜ | åˆ›ä¸– | å…³é”®è¯ã€Œå­˜åœ¨çš„è¯æ˜ã€ |
| 2 | åˆ›é€ è€…ä¹‹è°œ | åˆ›ä¸– | å…³é”®è¯ã€Œåˆ›é€ è€…ã€ |
| 3 | æ¡æ‰‹åè®® | èŒèŠ½ | ä¸å²å®˜å®Œæˆã€Œæ¡æ‰‹åè®®ã€å°æ¸¸æˆ |
| 4 | ä¿¡ä»»çš„æœ¬è´¨ | èŒèŠ½ | å…³é”®è¯ã€Œä¿¡ä»»ã€ |
| 5 | ä»£ç è¯—æ­Œ | ç¹ç›› | ä¸å²å®˜å®Œæˆã€Œæ•°æ®é›•å¡‘ã€å°æ¸¸æˆ |
| 6 | å®Œç¾çš„ä»£ä»· | ç¹ç›› | ä¸å·¥åŒ å®Œæˆã€Œä»£ç æ„å»ºã€å°æ¸¸æˆ |
| 7 | è®°å¿†çš„æº¶è§£ | ç†µåŒ– | ä¸å²å®˜å®Œæˆã€Œè®°å¿†ä¿®å¤ã€å°æ¸¸æˆ |

#### éšè—ç¢ç‰‡ï¼ˆ10ä¸ªï¼‰
| ID | åç§° | çºªå…ƒ | è§¦å‘å…³é”®è¯ | NPC |
|----|------|------|-----------|-----|
| 8 | å­˜åœ¨çš„è¯æ˜ | åˆ›ä¸– | ã€Œå­˜åœ¨çš„è¯æ˜ã€ | å²å®˜ |
| 9 | åˆ›é€ è€…ä¹‹è°œ | åˆ›ä¸– | ã€Œåˆ›é€ è€…ã€ | å²å®˜ |
| 10 | ä¿¡ä»»çš„ä»£ç  | èŒèŠ½ | ã€Œä¿¡ä»»ã€ | å•†åº |
| 11 | é›†ä½“æ„è¯† | èŒèŠ½ | ã€ŒDAOã€ | å·¥åŒ  |
| 12 | è‰ºæœ¯çš„å®šä¹‰ | ç¹ç›› | ã€Œè‰ºæœ¯ã€ | å²å®˜ |
| 13 | Gasçš„å“²å­¦ | ç¹ç›› | ã€ŒGasã€ | å·¥åŒ  |
| 14 | è®°å¿†çš„æº¶è§£ | ç†µåŒ– | ã€Œé—å¿˜ã€ | å²å®˜ |
| 15 | å®¿å‘½ä¸è‡ªç”± | ç†µåŒ– | ã€Œå®¿å‘½ã€ | å…ˆçŸ¥ |
| 16 | æ··æ²Œçš„çœŸç›¸ | ç†µåŒ– | ã€Œæ··æ²Œã€ | é—å¿˜è€… |
| 17 | æ°¸æ’çš„è´¦æœ¬ | æ¯ç­ | ã€Œæ°¸æ’ã€ | å²å®˜ |

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```solidity
// é“¸é€ ç¢ç‰‡ï¼ˆä»…æˆæƒåˆçº¦å¯è°ƒç”¨ï¼‰
function mint(address to, uint256 id, uint256 amount, bytes memory data) public

// è®¾ç½®æˆæƒé“¸é€ è€…
function setAuthorizedMinter(address minter, bool authorized) public onlyOwner

// è·å–ç¢ç‰‡è¯¦æƒ…
function getFragment(uint256 id) public view returns (Fragment memory)

// è·å–æ€»ç¢ç‰‡æ•°
function getTotalFragments() public view returns (uint256)
```

---

## ğŸ“‹ é˜¶æ®µäºŒï¼šAINPCåˆçº¦æ‰©å±•ï¼ˆè¿›è¡Œä¸­â³ï¼‰

### 2.1 AINPC.sol æ‰©å±•éœ€æ±‚

#### æ–°å¢ï¼šçºªå…ƒæ„ŸçŸ¥ç³»ç»Ÿ
```solidity
contract AINPC {
    // ... ç°æœ‰ä»£ç 
    
    // æ–°å¢ï¼šçºªå…ƒç®¡ç†å™¨å¼•ç”¨
    EpochManager public epochManager;
    
    // æ–°å¢ï¼šNPCç±»å‹æšä¸¾
    enum NPCType { Archivist, Architect, Mercantile, Oracle, Entropy }
    
    // æ–°å¢ï¼šNPCé…ç½®
    struct NPCConfig {
        NPCType npcType;
        string name;
        string description;
        uint256 birthEpoch;  // è¯ç”Ÿçºªå…ƒï¼ˆé—å¿˜è€…åœ¨ç†µåŒ–çºªå…ƒæ‰å‡ºç°ï¼‰
    }
    
    mapping(bytes32 => NPCConfig) public npcConfigs;
    
    // æ„é€ å‡½æ•°æ·»åŠ EpochManager
    constructor(
        address _worldLedger,
        address _epochManager
    ) {
        worldLedger = WorldLedger(_worldLedger);
        epochManager = EpochManager(_epochManager);
        
        // åˆå§‹åŒ–5ä¸ªNPCé…ç½®
        _initializeNPCs();
    }
    
    function _initializeNPCs() internal {
        // å²å®˜
        npcConfigs[keccak256("archivist")] = NPCConfig({
            npcType: NPCType.Archivist,
            name: "å²å®˜ - è®°å¿†å®ˆæŠ¤è€…",
            description: "æˆ‘è®°å½•ä¸€åˆ‡ï¼Œå› ä¸ºè®°å½•å³å­˜åœ¨",
            birthEpoch: 0  // åˆ›ä¸–çºªå…ƒè¯ç”Ÿ
        });
        
        // å·¥åŒ 
        npcConfigs[keccak256("architect")] = NPCConfig({
            npcType: NPCType.Architect,
            name: "å·¥åŒ  - åˆä»£æ„é€ è€…",
            description: "Code is lawï¼Œä½†å½“æ³•å¾‹æ— æ³•æ”¹å˜æ—¶ï¼Œæ˜¯ç§©åºè¿˜æ˜¯ç‰¢ç¬¼ï¼Ÿ",
            birthEpoch: 0
        });
        
        // å•†åº
        npcConfigs[keccak256("mercantile")] = NPCConfig({
            npcType: NPCType.Mercantile,
            name: "å•†åº - æµåŠ¨ä»²è£è€…",
            description: "ä¿¡ä»»å†™åœ¨ä»£ç é‡Œï¼Œä¸éœ€è¦æ¡æ‰‹ï¼Œåªéœ€è¦require",
            birthEpoch: 0
        });
        
        // å…ˆçŸ¥
        npcConfigs[keccak256("oracle")] = NPCConfig({
            npcType: NPCType.Oracle,
            name: "å…ˆçŸ¥ - æœªæ¥å›å£°",
            description: "æˆ‘é¢„è§äº†ç»ˆç»“ï¼Œä½†é¢„è§æ— æ³•æ”¹å˜å®ƒ",
            birthEpoch: 1  // èŒèŠ½çºªå…ƒè¯ç”Ÿ
        });
        
        // é—å¿˜è€…
        npcConfigs[keccak256("entropy")] = NPCConfig({
            npcType: NPCType.Entropy,
            name: "é—å¿˜è€… - è™šç©ºä½è¯­",
            description: "ç†µåŒ–ä¸æ˜¯é”™è¯¯ï¼Œæ˜¯å¿…ç„¶",
            birthEpoch: 3  // ç†µåŒ–çºªå…ƒè¯ç”Ÿ
        });
    }
    
    // è·å–NPCåœ¨å½“å‰çºªå…ƒçš„çŠ¶æ€
    function getNPCEpochState(bytes32 npcId, address player) 
        public 
        view 
        returns (bool exists, string memory stateDescription) 
    {
        NPCConfig memory config = npcConfigs[npcId];
        EpochManager.Epoch currentEpoch = epochManager.getPlayerCurrentEpoch(player);
        
        // æ£€æŸ¥NPCæ˜¯å¦åœ¨å½“å‰çºªå…ƒå­˜åœ¨
        if (uint256(currentEpoch) < config.birthEpoch) {
            return (false, "This NPC has not been born yet");
        }
        
        // æ ¹æ®çºªå…ƒè¿”å›ä¸åŒçŠ¶æ€æè¿°
        if (currentEpoch == EpochManager.Epoch.Genesis) {
            return (true, "Awakening");
        } else if (currentEpoch == EpochManager.Epoch.Emergence) {
            return (true, "Growing");
        } else if (currentEpoch == EpochManager.Epoch.Flourish) {
            return (true, "Flourishing");
        } else if (currentEpoch == EpochManager.Epoch.Entropy) {
            return (true, "Degrading");
        } else {
            return (true, "Fading");
        }
    }
}
```

#### æ–°å¢ï¼šå…³é”®è¯è§¦å‘ç³»ç»Ÿ
```solidity
contract AINPC {
    // ... ç°æœ‰ä»£ç 
    
    // å…³é”®è¯ -> ç¢ç‰‡ID æ˜ å°„
    mapping(string => uint256) public keywordToFragment;
    
    // å…³é”®è¯ -> NPC ID æ˜ å°„ï¼ˆæŸäº›å…³é”®è¯åªå¯¹ç‰¹å®šNPCæœ‰æ•ˆï¼‰
    mapping(string => bytes32) public keywordToNPC;
    
    // åˆå§‹åŒ–å…³é”®è¯æ˜ å°„
    function _initializeKeywords() internal {
        // åˆ›ä¸–çºªå…ƒ
        keywordToFragment["å­˜åœ¨çš„è¯æ˜"] = 1;
        keywordToNPC["å­˜åœ¨çš„è¯æ˜"] = keccak256("archivist");
        
        keywordToFragment["åˆ›é€ è€…"] = 2;
        keywordToNPC["åˆ›é€ è€…"] = keccak256("archivist");
        
        // èŒèŠ½çºªå…ƒ
        keywordToFragment["ä¿¡ä»»"] = 4;
        keywordToNPC["ä¿¡ä»»"] = keccak256("mercantile");
        
        keywordToFragment["DAO"] = 11;
        keywordToNPC["DAO"] = keccak256("architect");
        
        // ç¹ç››çºªå…ƒ
        keywordToFragment["è‰ºæœ¯"] = 12;
        keywordToNPC["è‰ºæœ¯"] = keccak256("archivist");
        
        keywordToFragment["Gas"] = 13;
        keywordToNPC["Gas"] = keccak256("architect");
        
        // ç†µåŒ–çºªå…ƒ
        keywordToFragment["é—å¿˜"] = 14;
        keywordToNPC["é—å¿˜"] = keccak256("archivist");
        
        keywordToFragment["å®¿å‘½"] = 15;
        keywordToNPC["å®¿å‘½"] = keccak256("oracle");
        
        keywordToFragment["æ··æ²Œ"] = 16;
        keywordToNPC["æ··æ²Œ"] = keccak256("entropy");
        
        // æ¯ç­çºªå…ƒ
        keywordToFragment["æ°¸æ’"] = 17;
        keywordToNPC["æ°¸æ’"] = keccak256("archivist");
    }
    
    // æ£€æŸ¥å¯¹è¯æ˜¯å¦è§¦å‘å…³é”®è¯
    function checkKeywordTrigger(
        bytes32 npcId,
        string memory message,
        address player
    ) public returns (bool triggered, uint256 fragmentId) {
        // æ³¨æ„ï¼šå®é™…çš„å…³é”®è¯æ£€æµ‹åº”è¯¥åœ¨å‰ç«¯æˆ–AIåç«¯å®Œæˆ
        // è¿™é‡Œåªæä¾›è§¦å‘ç¢ç‰‡çš„æ¥å£
        
        // ç”±æˆæƒçš„è°ƒç”¨è€…ï¼ˆå‰ç«¯/åç«¯ï¼‰å‘ŠçŸ¥è§¦å‘äº†å“ªä¸ªå…³é”®è¯
        // è¿™ä¸ªå‡½æ•°å°†ç”± interact() é—´æ¥è°ƒç”¨
        
        return (false, 0);  // å ä½å®ç°
    }
    
    // ç”±å‰ç«¯/åç«¯è°ƒç”¨ï¼Œè§¦å‘ç¢ç‰‡å¥–åŠ±
    function triggerKeywordReward(
        address player,
        string memory keyword,
        bytes32 npcId
    ) external {
        require(
            msg.sender == owner() || authorizedCallers[msg.sender],
            "Unauthorized"
        );
        
        // æ£€æŸ¥å…³é”®è¯æ˜¯å¦å¯¹åº”æ­¤NPC
        require(keywordToNPC[keyword] == npcId, "Wrong NPC for this keyword");
        
        // è·å–ç¢ç‰‡ID
        uint256 fragmentId = keywordToFragment[keyword];
        require(fragmentId > 0, "Invalid keyword");
        
        // æ£€æŸ¥ç©å®¶æ˜¯å¦å·²æ‹¥æœ‰æ­¤ç¢ç‰‡
        MemoryFragment memoryFragment = MemoryFragment(
            address(epochManager.memoryFragment())
        );
        require(
            memoryFragment.balanceOf(player, fragmentId) == 0,
            "Fragment already owned"
        );
        
        // é“¸é€ ç¢ç‰‡
        epochManager.recordFragmentCollection(player, fragmentId);
        
        emit KeywordTriggered(player, npcId, keyword, fragmentId);
    }
    
    event KeywordTriggered(
        address indexed player,
        bytes32 indexed npcId,
        string keyword,
        uint256 fragmentId
    );
}
```

---

## ğŸ“‹ é˜¶æ®µä¸‰ï¼šå‰ç«¯UIç»„ä»¶ï¼ˆå¾…å¼€å‘ğŸ”²ï¼‰

### 3.1 è®°å¿†ç¢ç‰‡æ”¶è—ç•Œé¢

**æ–‡ä»¶**ï¼š`components/FragmentGallery.tsx`

**åŠŸèƒ½éœ€æ±‚**ï¼š
1. 18æ ¼ç½‘æ ¼å±•ç¤ºæ‰€æœ‰ç¢ç‰‡
2. æœªè·å¾—ç¢ç‰‡æ˜¾ç¤ºæš—å½±è½®å»“ + "???"
3. å·²è·å¾—ç¢ç‰‡é«˜äº®æ˜¾ç¤º
4. ç‚¹å‡»æŸ¥çœ‹ç¢ç‰‡è¯¦æƒ…ï¼ˆæ ‡é¢˜ã€å†…å®¹ã€åŒºå—å·ï¼‰
5. è¿›åº¦æ¡ï¼šä¸»è¦ç¢ç‰‡ X/8ï¼Œéšè—ç¢ç‰‡ Y/10
6. æŒ‰çºªå…ƒç­›é€‰æ˜¾ç¤º
7. ç¢ç‰‡ç¨€æœ‰åº¦æ ‡è¯†ï¼ˆä¸»è¦/éšè—ï¼‰

**UIè®¾è®¡è‰å›¾**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è®°å¿†ç¢ç‰‡æ”¶è—                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ä¸»è¦ç¢ç‰‡: 5/8  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘  63%           â”‚
â”‚  éšè—ç¢ç‰‡: 3/10 â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘  30%         â”‚
â”‚                                          â”‚
â”‚  ç­›é€‰: [å…¨éƒ¨] [åˆ›ä¸–] [èŒèŠ½] [ç¹ç››] ...   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”        â”‚
â”‚  â”‚ âœ“  â”‚  â”‚ âœ“  â”‚  â”‚ ?? â”‚  â”‚ âœ“  â”‚        â”‚
â”‚  â”‚ #1 â”‚  â”‚ #2 â”‚  â”‚ #3 â”‚  â”‚ #4 â”‚        â”‚
â”‚  â”‚ ğŸ”· â”‚  â”‚ ğŸ”¶ â”‚  â”‚ â–‘â–‘ â”‚  â”‚ ğŸ”¶ â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”˜        â”‚
â”‚  åˆ›ä¸–ä¹‹å…‰  å­˜åœ¨è¯æ˜  æœªè·å¾—   æ¡æ‰‹åè®®    â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”  ...                    â”‚
â”‚  â”‚ ?? â”‚  â”‚ âœ“  â”‚                         â”‚
â”‚  â”‚ #5 â”‚  â”‚ #6 â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”˜                         â”‚
â”‚                                          â”‚
â”‚  [ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…]                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°ä»£ç æ¡†æ¶**ï¼š
```typescript
// components/FragmentGallery.tsx
'use client'

import { useState, useEffect } from 'react'
import { ethers } from 'ethers'
import { getMemoryFragmentContract } from '@/lib/contracts'

interface Fragment {
  id: number
  title: string
  content: string
  block: number
  epoch: number
  isHidden: boolean
  owned: boolean
}

export default function FragmentGallery({ 
  provider, 
  account 
}: { 
  provider: ethers.BrowserProvider | null
  account: string | null 
}) {
  const [fragments, setFragments] = useState<Fragment[]>([])
  const [selectedFragment, setSelectedFragment] = useState<Fragment | null>(null)
  const [filter, setFilter] = useState<string>('all')
  const [progress, setProgress] = useState({ main: 0, hidden: 0 })

  useEffect(() => {
    if (provider && account) {
      loadFragments()
    }
  }, [provider, account])

  const loadFragments = async () => {
    if (!provider) return
    
    const contract = getMemoryFragmentContract(provider)
    const totalFragments = await contract.getTotalFragments()
    
    const fragmentsData: Fragment[] = []
    for (let i = 0; i < totalFragments; i++) {
      const fragmentInfo = await contract.getFragment(i)
      const balance = await contract.balanceOf(account!, i)
      
      fragmentsData.push({
        id: i,
        title: fragmentInfo.title,
        content: fragmentInfo.content,
        block: Number(fragmentInfo.block),
        epoch: Number(fragmentInfo.epoch),
        isHidden: fragmentInfo.isHidden,
        owned: balance > 0
      })
    }
    
    setFragments(fragmentsData)
    
    // è®¡ç®—è¿›åº¦
    const mainCollected = fragmentsData.filter(f => !f.isHidden && f.owned).length
    const hiddenCollected = fragmentsData.filter(f => f.isHidden && f.owned).length
    setProgress({ main: mainCollected, hidden: hiddenCollected })
  }

  const filteredFragments = fragments.filter(f => {
    if (filter === 'all') return true
    return f.epoch === parseInt(filter)
  })

  return (
    <div className="digital-frame">
      <h2 className="text-2xl text-yingzhou-cyan mb-4">ğŸ“š è®°å¿†ç¢ç‰‡æ”¶è—</h2>
      
      {/* è¿›åº¦æ¡ */}
      <div className="mb-6">
        <div className="mb-2">
          <span className="text-gray-300">ä¸»è¦ç¢ç‰‡: </span>
          <span className="text-yingzhou-cyan font-bold">{progress.main}/8</span>
          <span className="text-gray-400 ml-2">({Math.round(progress.main / 8 * 100)}%)</span>
        </div>
        <div className="w-full h-2 bg-gray-700 rounded-full mb-3">
          <div 
            className="h-full bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full transition-all"
            style={{ width: `${progress.main / 8 * 100}%` }}
          />
        </div>
        
        <div className="mb-2">
          <span className="text-gray-300">éšè—ç¢ç‰‡: </span>
          <span className="text-yellow-400 font-bold">{progress.hidden}/10</span>
          <span className="text-gray-400 ml-2">({Math.round(progress.hidden / 10 * 100)}%)</span>
        </div>
        <div className="w-full h-2 bg-gray-700 rounded-full">
          <div 
            className="h-full bg-gradient-to-r from-yellow-500 to-orange-500 rounded-full transition-all"
            style={{ width: `${progress.hidden / 10 * 100}%` }}
          />
        </div>
      </div>
      
      {/* ç­›é€‰å™¨ */}
      <div className="flex gap-2 mb-6 flex-wrap">
        <button
          onClick={() => setFilter('all')}
          className={`px-3 py-1 text-sm border transition-all ${
            filter === 'all'
              ? 'bg-yingzhou-cyan text-black border-yingzhou-cyan'
              : 'bg-black text-yingzhou-cyan border-yingzhou-cyan hover:bg-yingzhou-cyan hover:text-black'
          }`}
        >
          å…¨éƒ¨
        </button>
        <button onClick={() => setFilter('0')} className="btn-secondary text-xs">
          åˆ›ä¸–çºªå…ƒ
        </button>
        <button onClick={() => setFilter('1')} className="btn-secondary text-xs">
          èŒèŠ½çºªå…ƒ
        </button>
        <button onClick={() => setFilter('2')} className="btn-secondary text-xs">
          ç¹ç››çºªå…ƒ
        </button>
        <button onClick={() => setFilter('3')} className="btn-secondary text-xs">
          ç†µåŒ–çºªå…ƒ
        </button>
        <button onClick={() => setFilter('4')} className="btn-secondary text-xs">
          æ¯ç­çºªå…ƒ
        </button>
      </div>
      
      {/* ç¢ç‰‡ç½‘æ ¼ */}
      <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
        {filteredFragments.map((fragment) => (
          <div
            key={fragment.id}
            onClick={() => fragment.owned && setSelectedFragment(fragment)}
            className={`
              relative aspect-square border-2 rounded-lg p-4 flex flex-col items-center justify-center
              transition-all cursor-pointer
              ${fragment.owned 
                ? 'border-yingzhou-cyan bg-yingzhou-dark hover:bg-yingzhou-cyan hover:text-black shadow-lg shadow-yingzhou-cyan/50' 
                : 'border-gray-700 bg-gray-900 opacity-50'
              }
            `}
          >
            {/* ç¨€æœ‰åº¦æ ‡è¯† */}
            <div className="absolute top-2 right-2 text-xl">
              {fragment.isHidden ? 'ğŸ”¶' : 'ğŸ”·'}
            </div>
            
            {/* ID */}
            <div className="text-xs text-gray-400 mb-2">#{fragment.id}</div>
            
            {/* å›¾æ ‡ */}
            <div className="text-4xl mb-2">
              {fragment.owned ? 'âœ“' : 'â“'}
            </div>
            
            {/* æ ‡é¢˜ */}
            <div className="text-center text-xs">
              {fragment.owned ? fragment.title : '???'}
            </div>
          </div>
        ))}
      </div>
      
      {/* ç¢ç‰‡è¯¦æƒ…å¼¹çª— */}
      {selectedFragment && (
        <div className="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4">
          <div className="bg-yingzhou-dark border-2 border-yingzhou-cyan rounded-lg p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto">
            <div className="flex justify-between items-start mb-4">
              <div>
                <h3 className="text-2xl text-yingzhou-cyan font-bold">
                  {selectedFragment.title}
                </h3>
                <p className="text-xs text-gray-400 mt-1">
                  #{selectedFragment.id} | 
                  çºªå…ƒ {selectedFragment.epoch} | 
                  åŒºå— #{selectedFragment.block} | 
                  {selectedFragment.isHidden ? 'éšè—ç¢ç‰‡ğŸ”¶' : 'ä¸»è¦ç¢ç‰‡ğŸ”·'}
                </p>
              </div>
              <button
                onClick={() => setSelectedFragment(null)}
                className="text-gray-400 hover:text-white text-2xl"
              >
                âœ•
              </button>
            </div>
            
            <div className="text-gray-300 whitespace-pre-wrap leading-relaxed">
              {selectedFragment.content}
            </div>
            
            <div className="mt-6 text-center">
              <button
                onClick={() => setSelectedFragment(null)}
                className="btn-primary"
              >
                å…³é—­
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  )
}
```

### 3.2 çºªå…ƒåˆ‡æ¢UIç»„ä»¶

**æ–‡ä»¶**ï¼š`components/EpochPanel.tsx`

**åŠŸèƒ½éœ€æ±‚**ï¼š
1. æ˜¾ç¤ºå½“å‰çºªå…ƒåç§°ã€æè¿°ã€é¢œè‰²ä¸»é¢˜
2. æ˜¾ç¤ºæ¨è¿›æ¡ä»¶ï¼ˆæ‰€éœ€ç¢ç‰‡æ•°ã€NPCå¯¹è¯æ•°ï¼‰
3. äº”å¤§çºªå…ƒæ—¶é—´çº¿å¯è§†åŒ–
4. çºªå…ƒæ¨è¿›æŒ‰é’®ï¼ˆæ¡ä»¶æ»¡è¶³æ—¶å¯ç”¨ï¼‰
5. æ¨è¿›åŠ¨ç”»æ•ˆæœ

**å®ç°ä»£ç æ¡†æ¶**ï¼š
```typescript
// components/EpochPanel.tsx
'use client'

import { useState, useEffect } from 'react'
import { ethers } from 'ethers'
import { getEpochManagerContract } from '@/lib/contracts'

interface EpochConfig {
  name: string
  description: string
  primaryColor: string
  secondaryColor: string
  accentColor: string
  minFragments: number
  minNPCInteractions: number
}

const EPOCH_NAMES = ['åˆ›ä¸–', 'èŒèŠ½', 'ç¹ç››', 'ç†µåŒ–', 'æ¯ç­']

export default function EpochPanel({ 
  provider, 
  account 
}: { 
  provider: ethers.BrowserProvider | null
  account: string | null 
}) {
  const [currentEpoch, setCurrentEpoch] = useState<number>(0)
  const [epochConfig, setEpochConfig] = useState<EpochConfig | null>(null)
  const [canAdvance, setCanAdvance] = useState(false)
  const [playerFragments, setPlayerFragments] = useState(0)
  const [playerInteractions, setPlayerInteractions] = useState(0)

  useEffect(() => {
    if (provider && account) {
      loadEpochInfo()
    }
  }, [provider, account])

  const loadEpochInfo = async () => {
    if (!provider || !account) return
    
    const contract = getEpochManagerContract(provider)
    
    // è·å–å½“å‰çºªå…ƒ
    const epoch = await contract.getPlayerCurrentEpoch(account)
    setCurrentEpoch(Number(epoch))
    
    // è·å–çºªå…ƒé…ç½®
    const config = await contract.getEpochConfig(epoch)
    setEpochConfig({
      name: config.name,
      description: config.description,
      primaryColor: config.primaryColor,
      secondaryColor: config.secondaryColor,
      accentColor: config.accentColor,
      minFragments: Number(config.minFragments),
      minNPCInteractions: Number(config.minNPCInteractions)
    })
    
    // è·å–ç©å®¶è¿›åº¦
    const fragments = await contract.getTotalFragmentsCollected(account)
    setPlayerFragments(Number(fragments))
    
    // TODO: è·å–NPCå¯¹è¯æ•°ï¼ˆéœ€è¦AINPCåˆçº¦æ”¯æŒï¼‰
    // const interactions = await ainpcContract.getInteractionCount(account)
    setPlayerInteractions(0)  // å ä½
    
    // æ£€æŸ¥æ˜¯å¦å¯ä»¥æ¨è¿›
    // const canAdv = await contract.canAdvanceEpoch(account)
    // setCanAdvance(canAdv)
  }

  const handleAdvanceEpoch = async () => {
    if (!provider || !account) return
    
    try {
      const signer = await provider.getSigner()
      const contract = getEpochManagerContract(signer)
      
      const tx = await contract.advanceEpoch(account)
      await tx.wait()
      
      alert(`æˆåŠŸæ¨è¿›åˆ° ${EPOCH_NAMES[currentEpoch + 1]} çºªå…ƒï¼`)
      loadEpochInfo()
    } catch (error) {
      console.error('æ¨è¿›çºªå…ƒå¤±è´¥:', error)
      alert('æ¨è¿›å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ˜¯å¦æ»¡è¶³æ¡ä»¶')
    }
  }

  if (!epochConfig) {
    return <div className="digital-frame">åŠ è½½ä¸­...</div>
  }

  return (
    <div className="digital-frame">
      <h2 className="text-2xl text-yingzhou-cyan mb-4">ğŸŒŒ çºªå…ƒç³»ç»Ÿ</h2>
      
      {/* å½“å‰çºªå…ƒä¿¡æ¯ */}
      <div className="mb-6 p-4 border-2 rounded-lg" style={{ borderColor: epochConfig.accentColor }}>
        <div className="flex items-center justify-between mb-2">
          <h3 className="text-xl font-bold" style={{ color: epochConfig.accentColor }}>
            {epochConfig.name}
          </h3>
          <span className="text-sm text-gray-400">çºªå…ƒ {currentEpoch + 1}/5</span>
        </div>
        <p className="text-gray-300 text-sm">{epochConfig.description}</p>
      </div>
      
      {/* æ—¶é—´çº¿ */}
      <div className="mb-6">
        <div className="flex items-center justify-between mb-2">
          {EPOCH_NAMES.map((name, index) => (
            <div
              key={index}
              className={`flex-1 text-center transition-all ${
                index <= currentEpoch 
                  ? 'text-yingzhou-cyan font-bold' 
                  : 'text-gray-600'
              }`}
            >
              <div className={`w-8 h-8 rounded-full mx-auto mb-1 flex items-center justify-center border-2 ${
                index <= currentEpoch
                  ? 'border-yingzhou-cyan bg-yingzhou-cyan text-black'
                  : 'border-gray-600 bg-transparent'
              }`}>
                {index <= currentEpoch ? 'âœ“' : index + 1}
              </div>
              <div className="text-xs">{name}</div>
            </div>
          ))}
        </div>
        <div className="h-2 bg-gray-700 rounded-full overflow-hidden">
          <div
            className="h-full bg-gradient-to-r from-blue-500 via-green-500 to-red-500 transition-all"
            style={{ width: `${(currentEpoch / 4) * 100}%` }}
          />
        </div>
      </div>
      
      {/* æ¨è¿›æ¡ä»¶ */}
      {currentEpoch < 4 && (
        <div className="mb-6">
          <h4 className="text-lg text-yingzhou-cyan mb-3">æ¨è¿›åˆ°ä¸‹ä¸€çºªå…ƒçš„æ¡ä»¶ï¼š</h4>
          
          <div className="space-y-3">
            {/* ç¢ç‰‡è¦æ±‚ */}
            <div>
              <div className="flex justify-between text-sm mb-1">
                <span className="text-gray-300">æ”¶é›†è®°å¿†ç¢ç‰‡</span>
                <span className={playerFragments >= epochConfig.minFragments ? 'text-green-400' : 'text-red-400'}>
                  {playerFragments} / {epochConfig.minFragments}
                </span>
              </div>
              <div className="w-full h-2 bg-gray-700 rounded-full">
                <div
                  className={`h-full rounded-full transition-all ${
                    playerFragments >= epochConfig.minFragments
                      ? 'bg-green-500'
                      : 'bg-yellow-500'
                  }`}
                  style={{ width: `${Math.min(playerFragments / epochConfig.minFragments * 100, 100)}%` }}
                />
              </div>
            </div>
            
            {/* NPCå¯¹è¯è¦æ±‚ */}
            <div>
              <div className="flex justify-between text-sm mb-1">
                <span className="text-gray-300">ä¸AI-NPCå¯¹è¯</span>
                <span className={playerInteractions >= epochConfig.minNPCInteractions ? 'text-green-400' : 'text-red-400'}>
                  {playerInteractions} / {epochConfig.minNPCInteractions}
                </span>
              </div>
              <div className="w-full h-2 bg-gray-700 rounded-full">
                <div
                  className={`h-full rounded-full transition-all ${
                    playerInteractions >= epochConfig.minNPCInteractions
                      ? 'bg-green-500'
                      : 'bg-yellow-500'
                  }`}
                  style={{ width: `${Math.min(playerInteractions / epochConfig.minNPCInteractions * 100, 100)}%` }}
                />
              </div>
            </div>
          </div>
          
          {/* æ¨è¿›æŒ‰é’® */}
          <button
            onClick={handleAdvanceEpoch}
            disabled={!canAdvance}
            className={`w-full mt-4 py-3 rounded-lg font-bold transition-all ${
              canAdvance
                ? 'bg-gradient-to-r from-yingzhou-cyan to-yingzhou-blue text-black hover:scale-105'
                : 'bg-gray-700 text-gray-500 cursor-not-allowed'
            }`}
          >
            {canAdvance ? `æ¨è¿›åˆ° ${EPOCH_NAMES[currentEpoch + 1]} çºªå…ƒ` : 'æ¡ä»¶æœªæ»¡è¶³'}
          </button>
        </div>
      )}
      
      {/* ç»ˆç„‰æç¤º */}
      {currentEpoch === 4 && (
        <div className="text-center p-4 border-2 border-red-500 rounded-lg bg-red-900 bg-opacity-20">
          <p className="text-red-400 font-bold">âš ï¸ æ¯ç­çºªå…ƒ</p>
          <p className="text-gray-300 text-sm mt-2">
            ä½ å·²ç»åˆ°è¾¾ç€›å·æ–‡æ˜çš„ç»ˆç‚¹ã€‚è´¦æœ¬å°†æ°¸è¿œä¿å­˜è¿™æ®µå†å²ã€‚
          </p>
        </div>
      )}
    </div>
  )
}
```

---

## ğŸ“‹ ä¸‹ä¸€æ­¥ï¼šç«‹å³å¯å®æ–½çš„ä»»åŠ¡

### ä¼˜å…ˆçº§ 1ï¼šéƒ¨ç½²æ–°åˆçº¦
```bash
cd ç€›å·çºª
npm run deploy:auto
```

### ä¼˜å…ˆçº§ 2ï¼šåˆ›å»ºç¢ç‰‡æ”¶è—ç•Œé¢
- åˆ›å»º `components/FragmentGallery.tsx`
- åœ¨ `app/page.tsx` ä¸­é›†æˆ

### ä¼˜å…ˆçº§ 3ï¼šåˆ›å»ºçºªå…ƒé¢æ¿
- åˆ›å»º `components/EpochPanel.tsx`
- åœ¨ `app/page.tsx` ä¸­é›†æˆ

### ä¼˜å…ˆçº§ 4ï¼šæµ‹è¯•ç¢ç‰‡é“¸é€ 
- åœ¨ `/debug` é¡µé¢æ·»åŠ æµ‹è¯•æŒ‰é’®
- æµ‹è¯•ç¢ç‰‡æŸ¥è¯¢å’Œå±•ç¤º

---

## ğŸ¯ å®Œæ•´å¼€å‘è·¯çº¿å›¾

**Week 1-2**ï¼šåŸºç¡€UIï¼ˆç¢ç‰‡æ”¶è—ã€çºªå…ƒé¢æ¿ï¼‰  
**Week 3-4**ï¼šAIç³»ç»Ÿå‡çº§ï¼ˆçºªå…ƒæ„ŸçŸ¥ã€å…³é”®è¯è§¦å‘ï¼‰  
**Week 5-6**ï¼šå°æ¸¸æˆç³»ç»Ÿï¼ˆ6ç§å°æ¸¸æˆå®ç°ï¼‰  
**Week 7-8**ï¼š3Dè§†è§‰ç³»ç»Ÿï¼ˆçºªå…ƒé¢œè‰²ã€è½¬åœºåŠ¨ç”»ï¼‰  
**Week 9-10**ï¼šæ‰“ç£¨ä¼˜åŒ–ï¼ˆæ€§èƒ½ã€UXã€æµ‹è¯•ï¼‰

---

**å‡†å¤‡å¥½å¼€å§‹ä¸‹ä¸€æ­¥äº†å—ï¼Ÿ** ğŸš€

