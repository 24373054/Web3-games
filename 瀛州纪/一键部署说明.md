# 🚀 瀛州纪 - 一键部署说明

## 快速开始（3步）

### 📌 方法一：使用一键脚本（推荐）

#### 步骤 1: 启动本地区块链
打开**第一个终端**，运行：
```bash
npx hardhat node
```
保持此终端运行，不要关闭！

#### 步骤 2: 部署合约
打开**第二个终端**，双击运行：
```
一键部署.bat
```
或者命令行运行：
```bash
npm run deploy:auto
```

#### 步骤 3: 启动前端
双击运行：
```
一键启动前端.bat
```
或者命令行运行：
```bash
npm run dev
```

访问 http://localhost:3000

---

### 📌 方法二：手动步骤

#### 1. 编译合约
```bash
npm run compile
```

#### 2. 启动本地链（新终端）
```bash
npx hardhat node
```

#### 3. 部署合约（新终端）
```bash
npm run deploy:auto
```

这个命令会：
- ✅ 部署所有智能合约
- ✅ 自动创建/更新 `.env.local` 文件
- ✅ 保留你的 API key 和私钥配置

#### 4. 启动前端
```bash
npm run dev
```

---

## 🔧 配置 MetaMask

1. **添加 Hardhat 本地网络**
   - 网络名称: `Hardhat Local`
   - RPC URL: `http://127.0.0.1:8545`
   - Chain ID: `31337`
   - 货币符号: `ETH`

2. **导入测试账户**
   - 从 `npx hardhat node` 终端复制私钥
   - MetaMask → 导入账户 → 粘贴私钥

---

## 📋 npm 命令参考

| 命令 | 说明 |
|------|------|
| `npm run compile` | 编译智能合约 |
| `npm run deploy:auto` | **自动部署并配置** |
| `npm run deploy` | 仅部署合约（不更新配置） |
| `npm run export-abi` | 导出 ABI 到 lib/abis/ |
| `npm run dev` | 启动前端开发服务器 |
| `npm test` | 运行合约测试 |
| `npm run airdrop` | 空投资源给测试账户 |

---

## 🐛 常见问题

### ❌ 错误: `could not decode result data`

**原因**：合约未部署或地址不正确

**解决**：
1. 确保 `npx hardhat node` 正在运行
2. 重新运行 `npm run deploy:auto`
3. 确认 `.env.local` 文件已生成

---

### ❌ MetaMask: `Nonce too high`

**原因**：重启了 Hardhat 节点，但 MetaMask 记住了旧的 nonce

**解决**：
1. MetaMask → 设置 → 高级
2. 清除活动数据和 Nonce
3. 刷新页面

---

### ❌ 无法连接钱包

**检查**：
- ✅ MetaMask 已切换到 `Hardhat Local` 网络
- ✅ Chain ID 是 `31337`
- ✅ RPC URL 是 `http://127.0.0.1:8545`
- ✅ 已导入测试账户

---

### ❌ 前端显示合约地址未配置

**原因**：`.env.local` 文件不存在或配置错误

**解决**：
1. 运行 `npm run deploy:auto`（会自动创建配置文件）
2. 或手动创建 `.env.local`，参考下方模板
3. 重启前端服务 `npm run dev`

---

## 📝 .env.local 文件模板

```env
# 智能合约地址（自动生成）
NEXT_PUBLIC_WORLD_LEDGER_ADDRESS=0x5FbDB2315678afecb367f032d93F642f64180aa3
NEXT_PUBLIC_DIGITAL_BEING_ADDRESS=0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
NEXT_PUBLIC_AINPC_ADDRESS=0xCf7Ed3AccA5a467e9e704C703E8D87F634fB0Fc9
NEXT_PUBLIC_RESOURCE1155_ADDRESS=0xDc64a140Aa3E981100a9becA4E685f962f0cF6C9
NEXT_PUBLIC_MARKET_ADDRESS=0x5FC8d32690cc91D4c39d9d3abcBD16989F875707

# 网络配置
NEXT_PUBLIC_CHAIN_ID=31337
NEXT_PUBLIC_RPC_URL=http://127.0.0.1:8545

# DeepSeek AI 配置
DEEPSEEK_API_KEY=sk-c23dd2d363044b2aad5788bf3003fc91
DEEPSEEK_MODEL=deepseek-chat

# 后端私钥（用于代发交易）
PRIVATE_KEY=59c6995e998f97a5a0044966f0945389dc9e86dae88c7a8412f4603b6b78690d
```

**注意**：运行 `npm run deploy:auto` 后，合约地址会自动更新！

---

## 🎮 开始游戏

1. ✅ 打开 http://localhost:3000
2. ✅ 点击"连接钱包"
3. ✅ 点击"铸造数字生命 NFT"
4. ✅ 选择一个 AI-NPC（如"史官"）
5. ✅ 开始对话！

---

## 📞 需要帮助？

- 📖 查看完整文档：[README.md](./README.md)
- 🎯 快速开始：[快速开始指南.md](./快速开始指南.md)
- 🚀 部署到测试网：[DEPLOYMENT.md](./DEPLOYMENT.md)
- 🏗️ 项目结构：[PROJECT_STRUCTURE.md](./PROJECT_STRUCTURE.md)

---

**祝你在瀛州的旅程愉快！** 🌌✨

